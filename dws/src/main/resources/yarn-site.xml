<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>

<configuration>
    <!-- https://blog.51cto.com/zhangxueliang/3162181 -->
    <!--resourcemanager start  -->
    <property>
        <name>yarn.resourcemanager.hostname</name>
        <value>hadoop02</value>
        <description>指定ResourceManager的地址</description>
    </property>

    <property>
        <name>yarn.resourcemanager.address</name>
        <value>${yarn.resourcemanager.hostname}:8032</value>
        <description>ResourceManager 对客户端暴露的地址。客户端通过该地址向RM提交应用程序，杀死应用程序等。</description>
    </property>

    <property>
        <name>yarn.resourcemanager.scheduler.address</name>
        <value>${yarn.resourcemanager.hostname}:8030</value>
        <description>ResourceManager 对ApplicationMaster暴露的访问地址。ApplicationMaster通过该地址向RM申请资源、释放资源等。</description>
    </property>
    <!--resourcemanager end  -->

    <!--nodemanager start  -->
    <property>
        <name>yarn.nodemanager.aux-services</name>
        <value>spark_shuffle,mapreduce_shuffle</value>
        <description>指定MR走shuffle;如果不配置spark on yarn,此处只设置为mapreduce_shuffle</description>
    </property>
    <property>
        <name>yarn.nodemanager.aux-services.spark_shuffle.class</name>
        <value>org.apache.spark.network.yarn.YarnShuffleService</value>
        <description>如果不配置 spark on yarn,不配置该项</description>
    </property>

    <property>
        <name>yarn.nodemanager.aux-services.mapreduce.shuffle.class</name>
        <value>org.apache.hadoop.mapred.ShuffleHandler</value>
        <description></description>
    </property>
    <property>
        <name>yarn.nodemanager.env-whitelist</name>
        <value>
            JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME
        </value>
        <description>环境变量的继承</description>
    </property>

    <property>
        <name>yarn.nodemanager.vmem-check-enabled</name>
        <value>false</value>
        <description>虚拟内存检查，默认打开，修改为关闭</description>
    </property>

    <property>
        <name>yarn.nodemanager.pmem-check-enabled</name>
        <value>false</value>
    </property>

    <property>
        <name>yarn.nodemanager.resource.memory-mb</name>
        <value>10240</value>
        <description>NodeManager 使用内存数，默认 8G，修改为 8G 内存</description>
    </property>

    <property>
        <name>yarn.nodemanager.resource.cpu-vcores</name>
        <value>8</value>
        <description>nodemanager 的 CPU 核数，不按照硬件环境自动设定时默认是 8 个，修改为 4 个</description>
    </property>

    <!--nodemanager end  -->

    <!--scheduler start  -->


    <property>
        <name>yarn.scheduler.capacity.root.support.user-limit-factor</name>
        <value>8</value>
    </property>
    <property>
        <name>yarn.scheduler.minimum-allocation-mb</name>
        <value>1024</value>
        <description>容器最小内存，默认 1G</description>
    </property>
    <property>
        <name>yarn.scheduler.maximum-allocation-mb</name>
        <value>10240</value>
        <description>容器最大内存，默认 8G，修改为 2G</description>
    </property>

    <property>
        <name>yarn.scheduler.increment-allocation-mb</name>
        <value>512</value>
    </property>


    <property>
        <name>yarn.scheduler.maximum-allocation-vcores</name>
        <value>16</value>
        <description>容器最大 CPU 核数，默认 4 个，修改为 4 个</description>
    </property>

    <property>
        <name>yarn.scheduler.minimum-allocation-vcores</name>
        <value>1</value>
    </property>

    <property>
        <name>yarn.scheduler.increment-allocation-vcores</name>
        <value>1</value>
    </property>

    <!--scheduler end -->

    

    <!--Fair start-->
    <!-- <property>
        <name>yarn.resourcemanager.scheduler.class</name>
        <value>org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler</value>
        <description>配置Yarn使用的调度器插件类名；Fair Scheduler对应的是：org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler</description>
    </property>
    <property>
        <name>yarn.scheduler.fair.allocation.file</name>
        <value>/opt/hadoop-3.1.3/etc/hadoop/fair-scheduler.xml</value>
        <description>配置资源池以及其属性配额的XML文件路径（本地路径）</description>
    </property>
    <property>
        <name>yarn.scheduler.fair.preemption</name>
        <value>true</value>
        <description>开启资源抢占,default is True</description>
    </property>
    <property>
        <name>yarn.scheduler.fair.user-as-default-queue</name>
        <value>true</value>
        <description>设置成true，当任务中未指定资源池的时候，将以用户名作为资源池名。这个配置就实现了根据用户名自动分配资源池。default is True</description>
    </property>
    <property>
        <name>yarn.scheduler.fair.allow-undeclared-pools</name>
        <value>false</value>
        <description>是否允许创建未定义的资源池。如果设置成true，yarn将会自动创建任务中指定的未定义过的资源池。设置成false之后，任务中指定的未定义的资源池将无效，该任务会被分配到default资源池中。default is True</description>
    </property> -->
    <!--Fair end-->

    <!--AM start -->
    <property>
        <name>yarn.app.mapreduce.am.resource.mb</name>
        <value>2048</value>
        <description>默认为1536。MR运行于YARN上时，为AM分配多少内存。默认值通常来说过 小，建议设置为2048或4096等较大的值。</description>
    </property>
    <!--AM end -->
    <!-- 开启日志聚集功能 -->
    <property>
        <name>yarn.log-aggregation-enable</name>
        <value>true</value>
    </property>

    <!-- 设置日志聚集服务器地址 -->
    <property>
        <name>yarn.log.server.url</name>
        <value>http://hadoop01:19888/jobhistory/logs</value>
    </property>

    <property>
        <name>yarn.nodemanager.env-whitelist</name>
        <value>
            JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME
        </value>
        <description>环境变量的继承</description>
    </property>

    <!-- 设置日志保留时间为7天 -->
    <property>
        <name>yarn.log-aggregation.retain-seconds</name>
        <value>604800</value>
    </property>

    <property>
        <name>yarn.application.classpath</name>
        <value>
            /opt/hadoop-3.1.3/etc/hadoop,
            /opt/hadoop-3.1.3/share/hadoop/common/*,
            /opt/hadoop-3.1.3/share/hadoop/common/lib/*,
            /opt/hadoop-3.1.3/share/hadoop/hdfs/*,
            /opt/hadoop-3.1.3/share/hadoop/hdfs/lib/*,
            /opt/hadoop-3.1.3/share/hadoop/mapreduce/*,
            /opt/hadoop-3.1.3/share/hadoop/mapreduce/lib/*,
            /opt/hadoop-3.1.3/share/hadoop/yarn/*,
            /opt/hadoop-3.1.3/share/hadoop/yarn/lib/*
        </value>
    </property>
</configuration>
